.. _essential_files:

===========
Input Files
===========

What Files Do I Need?
---------------------

1. 454-machine generated FASTA file(s) (.fna or .fasta)
2. Quality score file(s) (.qual)  - Optional
3. sff file(s) (.sff) - Optional
4. A mapping file generated by the user.  This file contains all of the information about the sequences necessary to perform the data analysis: the name of each sample, the barcode assignment of each sample (if preprocessing step is activated), the linker and primer sequence used to amplify each sample, any metadata that relates to the samples (for instance, health status or sampling site), and any additional information relating to specific samples that may be useful to have at hand when considering outliers (for example, what medications a patient was taking at time of sampling). See format specifications below.

File Format Details
-------------------

These are general guidelines that apply to multiple files:

1. Files should have proper file type suffix: E.g. '.fna' or '.fasta' for FASTA files, '.qual' for quality score files, '.sff' for flowgram files, '.txt' for the mapping files.
2. Do not use spaces in the filename. Use underscores or MixedCase instead. For example: :file:`amazon soil.fna` is not allowed, should be :file:`amazon_soil.fna` or :file:`AmazonSoil.fna`

FASTA File (.fna)
^^^^^^^^^^^^^^^^^

This file can be generated from a 454 sff file using the command: ::

	sffinfo -s NAME_OF_SFF_FILES > OUTPUT_FILE.fna

This is an example showing the first few raw sequences in an .fna file:

.. note::

	* >FV5UW9Z02IMIZQ length=42 xy=3419_3860 region=2 run=R_2009_05_20_11_44_59_
	* GACATCGGCTATCATGCTGCCTCCCTGNTGNNNNNCANNGCG
	* >FV5UW9Z02GOSNH length=243 xy=2625_2683 region=2 run=R_2009_05_20_11_44_59_
	* GACTAACGTCACCATGCTGCCTCCCGTAGGAGTCTGGACCGTGTCTCAGTTCCAGTGTGGCCGTTCATCCTCTCAGA
	* CCGGCTACTGATCGTCGCCTTGGTGAGCCGTTACCTCACCAACTAGCTAATCAGACGCGGGTCCATCTCATACCACC
	* GGAGTTTTTCACACTGTGCCATGCAGCACTGTGCGCTTATGCGGTATTAGCAGTCATTTCTAACTGTTATCCCCTGT
	* ATGAGGCAGGTT
	* >FV5UW9Z02FREEG length=271 xy=2245_1046 region=2 run=R_2009_05_20_11_44_59_
	* GACGAGTCAGTCCATGCTGCCTCCCGTAGGAGTTTGGGCCGTGTCTCAGTCCCAATGTGGCCGGTCACCCTCTCAGG
	* TCGGCTACTGATCGTCGCCTTGGTAGGCCGTTACCCCACCAACTAGCTAATCAGACGCGGGTCCATCTCATACCACC
	* GGAGTTTTTCACACCGTACCATGCGGTACTGTGCGCTTATGCGGTATTAGCAGCCGTTTCCAACTGTTATCCCCCTG
	* TATGAGGCAGGTTACCCACGCGTTACTCACCCGTCCGCCG
	* ...

Quality Score File (.qual) - Optional
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This is the 454-machine generated quality score file, which contains a score for each base in each sequence included in the FASTA file. It can be generated from an sff file using the command: ::

	sffinfo -q NAME_OF_SFF_FILES > OUTPUT_FILE.qual

The quality score file that corresponds to the above .fna example looks like this:

.. note::

	* >FV5UW9Z02IMIZQ length=42 xy=3419_3860 region=2 run=R_2009_05_20_11_44_59_
	* 32 32 32 32 32 25 25 25 32 32 32 32 32 32 32 32 32 32 37 40 37 37 30 30 25 25 25 
	* 0 25 30 0 0 0 0 0 27 24 0 0 27 27 15
	* >FV5UW9Z02GOSNH length=243 xy=2625_2683 region=2 run=R_2009_05_20_11_44_59_
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 39 39 39 39 36 29 29 29 29 
	* 29 29 29 33 33 33 39 39 39 39 40 40 40 40 40 40 40 40 37 37 37 37 38 38 36 36 36 
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 33 33 33 33 
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 38 38 38 38 37 37 37 37 37 37 37 37 37 37 
	* 37 36 36 36 37 36 28 28 28 28 28 36 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 
	* 36 36 36 36 36 37 37 37 37 37 37 37 36 36 36 36 37 37 37 37 37 32 22 22 22 22 22 
	* 22 33 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 
	* 36 36 36 36 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 36 28 28 28 33 33 35 
	* 31 37 37 35 31 31 26 19 19 22 22 22 26 36 36 36 36 36 36 36 36 36 36 36 36 25 25
	* >FV5UW9Z02FREEG length=271 xy=2245_1046 region=2 run=R_2009_05_20_11_44_59_
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 40 40 40 40 40 40 40 40 40 
	* 40 40 40 40 40 40 40 40 38 38 38 40 40 40 40 40 40 40 37 37 37 37 37 40 40 40 37 
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 33 33 34 34 37 34 33 34 38 38 37 37 37 37 
	* 37 37 37 37 33 33 33 33 33 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 40 40 40 40 
	* 40 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 
	* 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 37 
	* 38 38 38 40 38 38 38 38 33 33 33 33 33 40 38 38 38 38 38 38 38 38 40 38 38 38 38 
	* 38 40 32 32 32 32 32 32 32 32 32 32 32 32 31 31 32 25 25 25 31 30 21 20 20 25 28 
	* 30
	* ...

Flowgram File (.sff) - Optional
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

This file is found in the 454 data analysis folder in the "sff" directory. It contains all analyzed data from the sequencing run. This file and the qual file, are optional, which to allows for non-454 data (for example, using Sanger reads you may have already performed quality filtering on by the time you started using the pipeline, and/or sequences obtained from GenBank, which may not have quality scores. In these cases, the different kinds of data need to be processed separately with :file:`split_libraries.py`, and then the resulting FASTA files can be combined.

Mapping File (tab-delimited .txt)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The mapping file is generated by the user. This file contains all of the information about the sequences necessary to perform the data analysis: the name of each sample (SampleID), the DNA barcode used for each sample (BarcodeSequence), the linker and primer sequence used to amplify a given sample (LinkerPrimerSequence), any metadata that relates to the samples (for instance, health status or sampling site), and any additional information relating to specific samples that may be useful to have at hand when considering outliers (for example, what medications a patient was taking at time of sampling). See format specifications below.

The first few lines of a mapping file must look like the following:

.. note::

	* #SampleID	BarcodeSequence	LinkerPrimerSequence	HostMood	Description
	* #Example mapping file for QIIME.  Notes may be added on this line.
	* sample1	AGCACGAGCCTA	YATGCTGCCTCCCGTAGGAGT	tired		ear_sample_from_subject228
	* ...

You are strongly encouraged to validate your mapping file using :file:`check_id_map.py` before attempting to analyze your data. This tool will check for errors and make suggestions for other aspects of the file to be edited. Errors and warnings will be written to a log file and suggested corrections will be written to a :file:`_corrected.txt` version of the mapping file, both located in the specified output directory. Currently, the number of valid characters in the headers and data of the mapping file are quite restricted to ensure compatibility with downstream programs. For headers, only alphanumeric and underscores are accepted. Sample IDs, descriptions, and other metadata additionally accept the following characters: .+-%. Barcodes and linker/primer sequences must be IUPAC DNA characters. If invalid characters are found, the :file:`_corrected.txt` output file will have each of these replaced with an underscore.

The mapping file relates barcodes in the FASTA file to each sample and their related metadata. Each FASTA file must have at least one mapping file but multiple mapping files can be defined for any given FASTA file. For example, if you have bundled several unrelated studies into one 454 run (for instance, a mouse study, a soil study and a fish study), and need to analyze each study separately, you would generate three separate mapping files that specify a subset of samples and their associated metadata. Alternatively, you can combine multiple runs (e.g. multiple 454 runs, multiple FASTA files) with a single mapping file.

The mapping file is organized to contain data in columns with headers. As such, it is usually generated by users in Excel. However, it cannot be submitted in Excel format, it must be submitted in tab-delimited text format. Simply saving an excel spreadsheet in tab-delimited text format may be problematic because it will include extra trailing empty columns. One way around this is to copy and paste the highlighted data into a more simple text editing program.

The mapping file format is tab-delimited text. This must be plain text, therefore Word and Excel documents cannot be read directly. The first line of the mapping file is the header line and it MUST start with a "#" character. Optionally, lines immediately following the header line that start with a "#" character will be treated as run description lines. This section is for descriptions that apply to all samples in the mapping file (as opposed to / in addition to the descriptions that apply to each individual sample).

Each column header MUST contain alphanumeric (a-z, A-Z and 1-9) and/or underscore ("_") characters only, where the header MUST start with letter. All other characters (e.g. $, \*, \^, etc) are not supported at this time and use of those characters may cause problems downstream in the QIIME pipeline. Sample IDs, descriptions, and metadata fields additionally allow the use of plus(+), minus(-), period(.), and percent (%) characters.

Currently, the user has the ability to define their own column headers, however; QIIME will be adopting the MIENS standard, therefore all column headings MUST correspond the proper MIENS nomenclature (http://gensc.org/gc_wiki/index.php/MIENS). The following details the current mapping file guidelines:

1. The first column header must be "#SampleID", and the data in this column must contain unique (short and meaningful) sample identifiers containing only alphanumeric, period (".") and/or underscore ("_") characters.
2. The second column header must be "BarcodeSequence", where each value in that column corresponds to the barcode used for each sample.  Only IUPAC DNA characters are acceptable.
3. The third column header must be “LinkerPrimerSequence”, where each value in that column corresponds to the primer used to amplify that sample.  Only IUPAC DNA characters are acceptable.
4. All subsequent column headers (except the last one) are metadata headers. For example, a "Smoker" column would include either "Yes" or "No". Note that the data in each column is assumed to be categorical unless specified otherwise. Categorical data columns must include at least 2 unique values per column. All metadata must be composed of only alphanumeric, underscore ("_"), period ("."), minus sign ("-"), plus sign ("+") and/or percentage ("%") characters. For missing data, write "NA"; do not leave blanks.
5. The last column of the mapping file must be named "Description". Information in this column includes information that is unique to each sample, such as the medications taken by the patient, or any other descriptive information. The same character restrictions that apply to the metadata columns in guildline four apply to sample descriptions.  Sample/Run Description should be kept brief, if possible. Information that applies to all samples in a mapping file should go in the run description section, which is defined as lines starting with a "#" character, immediately following the header line (See example format below.) Information that is specific to a particular sample should go in the "Description" column.
6. There should be no empty lines or comment lines (starting with #) throughout the metadata, with the exception of any additional run description lines that immediately follow the initial header line.

Notes for more than one mapping or FASTA file at once:

1. If you want to use a single mapping file with multiple FASTA files, MAKE SURE NO BARCODES ARE REPEATED BETWEEN THE RUNS.
2. If you are providing multiple mapping files for a single FASTA file, make sure that use of column headers is consistent across all files. (Case-sensitive!) E.g. "Barcode" is not the same as "BarCode" is not the same as "barcode" is not the same as "Bar_code".

Example Mapping Files:

1. Mapping file with a unique "Description" column:

.. note::

	* #SampleID	BarcodeSequence	LinkerPrimerSequence	AnimalDiet	...	Description
	* A			CGAGTCTAGTTG	YATGCTGCCTCCCGTAGGAGT	Carnivore	...	Lion_11 
	* B			CCGACTGAGATG	YATGCTGCCTCCCGTAGGAGT	Herbivore	...	Kangaroo_3
	* C			TCGCCTGAGATG	YATGCTGCCTCCCGTAGGAGT	Omnivore	...	Human_34
	* ...

2. Mapping file with "run description" lines following the "header line":

.. note::

	* #SampleID	BarcodeSequence	LinkerPrimerSequence	AnimalDiet	...	Description
	* # This is a "run description" example. It can span as many lines as needed
	* # before the rest of the mapping file starts. Each line must begin with
	* # the pound '#' character. You do not have to wrap your lines but it may make
	* # your "run description" section easier to read.
	* # The run description should contain a general description of the run
	* # and details that might be useful in interpreting the results such as:
	* # 1) what type of samples are in this run, 2) where and when they were collected,
	* # 3) how they were prepped, 4) what type of barcodes and primers were used
	* # 5) where they were sequenced (e.g. facility) or collected from
	* # (e.g. public databases), 6) what you are expecting/hoping to find in the run
	* # 7) any possible problems (technical e.g. during prep/sequencing, experimental
	* # etc) 8) etc.
	* # The description in this section will be applied to any individual samples
	* # that are missing a value in the 'Description' column
	* #SampleID	BarcodeSequence	LinkerPrimerSequence	AnimalDiet	...	Description
	* A			CGAGTCTAGTTG	YATGCTGCCTCCCGTAGGAGT	Carnivore	...	Lion_11 
	* B			CCGACTGAGATG	YATGCTGCCTCCCGTAGGAGT	Herbivore	...	Kangaroo_3
	* C			TCGCCTGAGATG	YATGCTGCCTCCCGTAGGAGT	Omnivore	...	Human_34
	* ...

